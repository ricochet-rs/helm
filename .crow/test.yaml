when:
  - event: tag
  - event: push
    branch: main
  - event: pull_request

labels:
  agent: thumper

matrix:
  include:
    # renovate: datasource=github-releases depName=helm/helm extractVersion=^v(?<version>.*)$
    - HELM_VERSION: 3.19.0
      # renovate: datasource=github-releases depName=helm-unittest/helm-unittest extractVersion=^v(?<version>.*)$
      HELM_UNITTEST_VERSION: 1.0.3

steps:
  lint:
    image: reg.ricochet.rs/docker.io/alpine/helm:3.20.0
    commands:
      - helm lint --with-subcharts charts/*

  unittest:
    image: reg.ricochet.rs/docker.io/helmunittest/helm-unittest:${HELM_VERSION}-${HELM_UNITTEST_VERSION}
    commands:
      - helm unittest --strict -f 'unittests/**/*.yaml' ./charts/*
