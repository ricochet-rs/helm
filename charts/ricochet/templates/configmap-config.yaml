{{- if or (ne (len .Values.config) 0) .Values.existingConfigMap -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "ricochet.fullname" . }}-config
  labels:
    {{- include "ricochet.labels" . | nindent 4 }}
    app.kubernetes.io/component: config
data:
  ricochet-config.toml: |
{{- if .Values.config.raw }}
    {{- .Values.config.raw | nindent 4 }}
{{- else }}
    # Ricochet Configuration
    # Generated by Helm

    {{- range $section, $values := .Values.config }}
    {{- if and (ne $section "raw") (ne $section "custom") (ne $section "secrets") (ne $section "existingConfigMap") $values }}

    [{{ $section }}]
    {{- range $key, $value := $values }}
    {{- if eq (kindOf $value) "string" }}
    {{ $key }} = {{ $value | quote }}
    {{- else if eq (kindOf $value) "bool" }}
    {{ $key }} = {{ $value }}
    {{- else if or (eq (kindOf $value) "float64") (eq (kindOf $value) "int64") (eq (kindOf $value) "int") }}
    {{ $key }} = {{ $value }}
    {{- else if eq (kindOf $value) "slice" }}
    {{ $key }} = [{{ range $i, $v := $value }}{{ if $i }}, {{ end }}{{ $v | quote }}{{ end }}]
    {{- else if eq (kindOf $value) "map" }}
    # Complex nested value - using inline table
    {{ $key }} = { {{ range $k, $v := $value }}{{ $k }} = {{ $v | quote }}, {{ end }}}
    {{- end }}
    {{- end }}
    {{- end }}
    {{- end }}

    {{- with .Values.config.custom }}
    # Custom configuration
    {{- . | nindent 4 }}
    {{- end }}
{{- end }}
{{- end }}
