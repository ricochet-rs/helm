{{- if .Values.config.secrets -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "ricochet.fullname" . }}-config
  labels:
    {{- include "ricochet.labels" . | nindent 4 }}
    app.kubernetes.io/component: config
type: Opaque
stringData:
  ricochet-config-secret.toml: |
    # Ricochet Secret Configuration
    # Generated by Helm - References to existing secrets
    # This file contains placeholders that will be replaced by the init container

    {{- range $section, $secretRefs := .Values.config.secrets }}
    {{- if $secretRefs }}

    [{{ $section }}]
    {{- range $key, $ref := $secretRefs }}
    {{- if kindOf $ref | eq "map" }}
    {{- if $ref.secretName }}
    # From secret: {{ $ref.secretName }}, key: {{ $ref.key | default $key }}
    {{ $key }} = "SECRET_PLACEHOLDER_{{ $section | upper }}_{{ $key | upper }}"
    {{- end }}
    {{- else }}
    # Using existing secret: {{ $ref }}
    {{ $key }} = "SECRET_PLACEHOLDER_{{ $section | upper }}_{{ $key | upper }}"
    {{- end }}
    {{- end }}
    {{- end }}
    {{- end }}
{{- end }}
